<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Congruent and Similar Triangles Quiz / ÂÖ®Á≠âÂèäÁõ∏‰ºº‰∏âËßíÂΩ¢Ê∏¨È©ó</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Nunito:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Nunito', 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff;
            background-image: radial-gradient(#bae6fd 1px, transparent 1px);
            background-size: 20px 20px;
        }

        h1, h2, h3, .btn-font {
            font-family: 'Fredoka', 'Noto Sans TC', sans-serif;
        }

        .triangle-path {
            fill: rgba(56, 189, 248, 0.1);
            stroke: #0ea5e9;
            stroke-width: 2.5;
            stroke-linejoin: round;
            stroke-linecap: round;
        }

        .mark-stroke {
            stroke: #dc2626; /* Red for high contrast markings */
            stroke-width: 2.5;
            fill: none;
        }

        .angle-fill {
            fill: rgba(220, 38, 38, 0.1); /* Light red fill for angles */
        }

        .card {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .option-btn {
            transition: transform 0.1s, background-color 0.2s;
            white-space: pre-wrap; /* Allow text wrapping for bilingual labels */
            line-height: 1.2;
        }
        .option-btn:active {
            transform: scale(0.98);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom Scrollbar for results */
        #results-screen::-webkit-scrollbar {
            width: 8px;
        }
        #results-screen::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        #results-screen::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        #results-screen::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        
        /* Trophy Animation */
        .trophy-pop {
            animation: trophyPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes trophyPop {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen items-center p-4">

    <!-- App Container -->
    <div id="app" class="w-full max-w-4xl">
        
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-sky-800 mb-2">Congruent & Similar Triangles Quiz<br><span class="text-xl md:text-2xl">ÂÖ®Á≠âÂèäÁõ∏‰ºº‰∏âËßíÂΩ¢Ê∏¨È©ó</span></h1>
            <p class="text-sky-600 font-semibold text-lg">Test your knowledge / Ê∏¨Ë©¶‰Ω†ÁöÑÁü•Ë≠ò</p>
        </header>

        <!-- === QUIZ VIEW === -->
        <div id="view-quiz" class="fade-in w-full max-w-2xl mx-auto">
            <div class="card bg-white rounded-3xl overflow-hidden border-4 border-sky-100 relative">
                
                <!-- Progress -->
                <div class="w-full h-3 bg-sky-100">
                    <div id="progress-bar" class="h-full bg-sky-500 transition-all duration-500" style="width: 0%"></div>
                </div>

                <!-- Quiz Content -->
                <div id="quiz-content" class="p-6 md:p-8">
                    
                    <div class="mb-4 text-center">
                        <span id="question-type-badge" class="inline-block px-3 py-1 rounded-full text-sm font-bold bg-sky-100 text-sky-700 uppercase tracking-wider mb-2">
                            Question Type
                        </span>
                        <h2 class="text-lg md:text-xl font-bold text-slate-800" id="question-text">
                            Identify the condition
                        </h2>
                    </div>

                    <!-- SVG Container -->
                    <div class="bg-slate-50 rounded-2xl border-2 border-slate-100 mb-6 flex justify-center items-center overflow-hidden relative" style="min-height: 260px;">
                        <div id="quiz-svg-container" class="w-full h-full flex justify-center items-center fade-in"></div>
                    </div>

                    <!-- Feedback -->
                    <div id="feedback" class="hidden mb-4 text-center font-bold text-lg p-3 rounded-lg fade-in"></div>

                    <!-- Options -->
                    <div id="options-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <!-- Buttons injected via JS -->
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex justify-between mt-6 gap-4 border-t border-slate-100 pt-6">
                        <button id="btn-prev" onclick="prevQuestion()" class="flex-1 btn-font bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-3 px-4 rounded-xl text-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            &larr; Prev / ‰∏ä‰∏ÄÈ°å
                        </button>
                        <button id="btn-next" onclick="nextQuestion()" class="flex-1 btn-font bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-4 rounded-xl text-lg shadow-[0_4px_0_rgb(14,116,144)] active:translate-y-[4px] active:shadow-none transition-all">
                            Next / ‰∏ã‰∏ÄÈ°å &rarr;
                        </button>
                    </div>
                </div>

                <!-- Results Screen -->
                <div id="results-screen" class="hidden absolute inset-0 bg-white z-20 flex flex-col overflow-y-auto p-4 md:p-8 fade-in">
                    <div class="w-full max-w-2xl mx-auto flex flex-col items-center pb-8">
                        
                        <!-- Trophy Icon Container -->
                        <div class="w-28 h-28 bg-yellow-100 rounded-full flex items-center justify-center mb-6 mt-8 shadow-sm trophy-pop">
                            <span class="text-6xl drop-shadow-sm">üèÜ</span>
                        </div>

                        <h2 class="text-3xl font-bold text-slate-800 mb-2 text-center">Quiz Complete! <br> <span class="text-2xl">Ê∏¨È©óÂÆåÊàêÔºÅ</span></h2>
                        <p class="text-xl text-slate-600 mb-8 text-center flex items-center justify-center gap-2">
                            Score / ÂæóÂàÜ: 
                            <span class="font-bold text-sky-600 text-3xl flex items-center gap-1">
                                <span id="final-score">0</span> / <span id="total-questions">0</span>
                            </span>
                        </p>
                        
                        <button onclick="startQuiz()" class="btn-font bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-8 rounded-xl text-xl shadow-[0_4px_0_rgb(14,116,144)] active:translate-y-[4px] active:shadow-none transition-all mb-8">
                            Play Again / ÂÜçÁé©‰∏ÄÊ¨°
                        </button>

                        <div class="w-full border-t-2 border-sky-100 pt-6">
                            <h3 class="text-xl font-bold text-sky-800 mb-4 text-center">Review Answers / Ê™¢Ë®éÁ≠îÊ°à</h3>
                            <div id="summary-list" class="space-y-4">
                                <!-- Summary Cards injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4 text-sky-900/40 text-sm font-semibold">
                Score / ÂàÜÊï∏: <span id="current-score">0</span>
            </div>
        </div>

    </div>

    <script>
        /* -------------------------------------------------------------------------- */
        /* GEOMETRY ENGINE                              */
        /* -------------------------------------------------------------------------- */

        const createSVG = (content) => `
            <svg viewBox="0 0 500 250" class="w-full h-full max-w-[500px]" xmlns="http://www.w3.org/2000/svg">
                ${content}
            </svg>
        `;

        const tri1 = {
            p1: {x: 40, y: 200},
            p2: {x: 180, y: 200},
            p3: {x: 100, y: 60}
        };

        const polyPoints = (t) => `${t.p1.x},${t.p1.y} ${t.p2.x},${t.p2.y} ${t.p3.x},${t.p3.y}`;

        // Create a second triangle (shifted, optionally mirrored)
        const getTri2 = (shiftX, mirror = false) => {
            let t = {
                p1: {x: tri1.p1.x + shiftX, y: tri1.p1.y},
                p2: {x: tri1.p2.x + shiftX, y: tri1.p2.y},
                p3: {x: tri1.p3.x + shiftX, y: tri1.p3.y}
            };
            if(mirror) {
                const cx = (t.p1.x + t.p2.x + t.p3.x) / 3;
                t.p1.x = cx + (cx - t.p1.x);
                t.p2.x = cx + (cx - t.p2.x);
                t.p3.x = cx + (cx - t.p3.x);
            }
            return t;
        };

        // Create a scaled triangle based on global tri1 proportions
        // Base dimensions: Width=140, Height=140
        const getCustomTri = (scale, startX) => {
            const w = 140 * scale;
            const h = 140 * scale;
            const p1 = { x: startX, y: 200 };
            const p2 = { x: startX + w, y: 200 };
            // Original p3 offset from p1 was (60, -140)
            const p3 = { x: startX + (60 * scale), y: 200 - h };
            return { p1, p2, p3 };
        };

        const drawTriangle = (t) => `<polygon points="${polyPoints(t)}" class="triangle-path" />`;

        const drawTick = (pA, pB, count) => {
            const mx = (pA.x + pB.x) / 2;
            const my = (pA.y + pB.y) / 2;
            const dx = pB.x - pA.x;
            const dy = pB.y - pA.y;
            const len = Math.sqrt(dx*dx + dy*dy);
            const nx = -dy / len * 10;
            const ny = dx / len * 10;
            
            let svg = '';
            const spacing = 6;
            const offsetStart = -((count-1)*spacing)/2;

            for(let i=0; i<count; i++) {
                const off = offsetStart + (i*spacing);
                const ux = dx/len * off;
                const uy = dy/len * off;
                svg += `<line x1="${mx + ux - nx}" y1="${my + uy - ny}" x2="${mx + ux + nx}" y2="${my + uy + ny}" class="mark-stroke" />`;
            }
            return svg;
        };

        const drawAngle = (pPrev, pVertex, pNext, count, isRight = false) => {
            if(isRight) {
                const size = 15;
                const angle1 = Math.atan2(pPrev.y - pVertex.y, pPrev.x - pVertex.x);
                const angle2 = Math.atan2(pNext.y - pVertex.y, pNext.x - pVertex.x);
                const v1x = Math.cos(angle1) * size;
                const v1y = Math.sin(angle1) * size;
                const v2x = Math.cos(angle2) * size;
                const v2y = Math.sin(angle2) * size;
                return `<path d="M ${pVertex.x + v1x} ${pVertex.y + v1y} L ${pVertex.x + v1x + v2x} ${pVertex.y + v1y + v2y} L ${pVertex.x + v2x} ${pVertex.y + v2y}" class="mark-stroke" stroke-width="2" />`;
            }

            const r = 25;
            const startAngle = Math.atan2(pPrev.y - pVertex.y, pPrev.x - pVertex.x);
            const endAngle = Math.atan2(pNext.y - pVertex.y, pNext.x - pVertex.x);
            
            let diff = endAngle - startAngle;
            while (diff <= -Math.PI) diff += 2 * Math.PI;
            while (diff > Math.PI) diff -= 2 * Math.PI;
            const sweepFlag = diff > 0 ? 1 : 0;

            let svg = '';
            const spacing = 5;
            for(let i=0; i<count; i++) {
                const radius = r + (i*spacing);
                const x1 = pVertex.x + radius * Math.cos(startAngle);
                const y1 = pVertex.y + radius * Math.sin(startAngle);
                const x2 = pVertex.x + radius * Math.cos(endAngle);
                const y2 = pVertex.y + radius * Math.sin(endAngle);
                
                svg += `<path d="M ${pVertex.x} ${pVertex.y} L ${x1} ${y1} A ${radius} ${radius} 0 0 ${sweepFlag} ${x2} ${y2} Z" class="angle-fill" opacity="0.3" />`;
                svg += `<path d="M ${x1} ${y1} A ${radius} ${radius} 0 0 ${sweepFlag} ${x2} ${y2}" class="mark-stroke" fill="none" />`;
            }
            return svg;
        };
        
        // Helper to draw text labels for side lengths
        const drawLabel = (pA, pB, text, offset = 22) => {
            const mx = (pA.x + pB.x) / 2;
            const my = (pA.y + pB.y) / 2;
            const dx = pB.x - pA.x;
            const dy = pB.y - pA.y;
            const len = Math.sqrt(dx*dx + dy*dy);
            const nx = -dy / len * offset;
            const ny = dx / len * offset;
            
            return `<text x="${mx + nx}" y="${my + ny + 5}" fill="#0369a1" font-size="16" font-family="Nunito, sans-serif" font-weight="700" text-anchor="middle" style="text-shadow: 2px 2px 0 #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;">${text}</text>`;
        };

        /* -------------------------------------------------------------------------- */
        /* DATA SOURCE                                 */
        /* -------------------------------------------------------------------------- */

        const congruentData = [
            {
                id: 'SSS',
                title: 'Side-Side-Side (SSS)',
                question: 'Which condition proves these triangles are CONGRUENT?\nÂì™‰∏ÄÂÄãÊ¢ù‰ª∂Ë≠âÊòéÈÄô‰∫õ‰∏âËßíÂΩ¢ÂÖ®Á≠âÔºü',
                answer: 'SSS',
                distractors: ['SAS', 'ASA', 'RHS'],
                explanation: 'Three pairs of corresponding sides are equal. / ‰∏âÁµÑÂ∞çÊáâÈÇäÁõ∏Á≠â„ÄÇ',
                render: () => {
                    const t1 = tri1; const t2 = getTri2(250, true);
                    let s = drawTriangle(t1) + drawTriangle(t2);
                    s += drawTick(t1.p1, t1.p2, 1) + drawTick(t2.p1, t2.p2, 1);
                    s += drawTick(t1.p2, t1.p3, 2) + drawTick(t2.p2, t2.p3, 2);
                    s += drawTick(t1.p3, t1.p1, 3) + drawTick(t2.p3, t2.p1, 3);
                    return s;
                }
            },
            {
                id: 'SAS',
                title: 'Side-Angle-Side (SAS)',
                question: 'Which condition proves these triangles are CONGRUENT?\nÂì™‰∏ÄÂÄãÊ¢ù‰ª∂Ë≠âÊòéÈÄô‰∫õ‰∏âËßíÂΩ¢ÂÖ®Á≠âÔºü',
                answer: 'SAS',
                distractors: ['SSS', 'AAS', 'RHS'],
                explanation: 'Two sides and the included angle are equal. / ÂÖ©ÈÇäÂèäÂ§æËßíÁõ∏Á≠â„ÄÇ',
                render: () => {
                    const t1 = tri1; const t2 = getTri2(250);
                    let s = drawTriangle(t1) + drawTriangle(t2);
                    s += drawTick(t1.p1, t1.p2, 1) + drawTick(t2.p1, t2.p2, 1);
                    s += drawTick(t1.p1, t1.p3, 2) + drawTick(t2.p1, t2.p3, 2);
                    s += drawAngle(t1.p2, t1.p1, t1.p3, 1) + drawAngle(t2.p2, t2.p1, t2.p3, 1);
                    return s;
                }
            },
            {
                id: 'ASA',
                title: 'Angle-Side-Angle (ASA)',
                question: 'Which condition proves these triangles are CONGRUENT?\nÂì™‰∏ÄÂÄãÊ¢ù‰ª∂Ë≠âÊòéÈÄô‰∫õ‰∏âËßíÂΩ¢ÂÖ®Á≠âÔºü',
                answer: 'ASA',
                distractors: ['SAS', 'SSS', 'AAS'],
                explanation: 'Two angles and the included side are equal. / ÂÖ©ËßíÂèäÂ§æÈÇäÁõ∏Á≠â„ÄÇ',
                render: () => {
                    const t1 = tri1; const t2 = getTri2(250, true);
                    let s = drawTriangle(t1) + drawTriangle(t2);
                    s += drawAngle(t1.p2, t1.p1, t1.p3, 1) + drawAngle(t2.p2, t2.p1, t2.p3, 1);
                    s += drawAngle(t1.p1, t1.p2, t1.p3, 2) + drawAngle(t2.p1, t2.p2, t2.p3, 2);
                    s += drawTick(t1.p1, t1.p2, 1) + drawTick(t2.p1, t2.p2, 1);
                    return s;
                }
            },
            {
                id: 'AAS',
                title: 'Angle-Angle-Side (AAS)',
                question: 'Which condition proves these triangles are CONGRUENT?\nÂì™‰∏ÄÂÄãÊ¢ù‰ª∂Ë≠âÊòéÈÄô‰∫õ‰∏âËßíÂΩ¢ÂÖ®Á≠âÔºü',
                answer: 'AAS',
                distractors: ['ASA', 'SAS', 'RHS'],
                explanation: 'Two angles and a non-included side are equal. / ÂÖ©ËßíÂèäÈùûÂ§æÈÇäÁõ∏Á≠â„ÄÇ',
                render: () => {
                    const t1 = tri1; const t2 = getTri2(250);
                    let s = drawTriangle(t1) + drawTriangle(t2);
                    s += drawAngle(t1.p2, t1.p1, t1.p3, 1) + drawAngle(t2.p2, t2.p1, t2.p3, 1);
                    s += drawAngle(t1.p1, t1.p2, t1.p3, 2) + drawAngle(t2.p1, t2.p2, t2.p3, 2);
                    s += drawTick(t1.p1, t1.p3, 1) + drawTick(t2.p1, t2.p3, 1);
                    return s;
                }
            },
            {
                id: 'RHS',
                title: 'Right-Angle Hypotenuse Side (RHS)',
                question: 'Which condition proves these triangles are CONGRUENT?\nÂì™‰∏ÄÂÄãÊ¢ù‰ª∂Ë≠âÊòéÈÄô‰∫õ‰∏âËßíÂΩ¢ÂÖ®Á≠âÔºü',
                answer: 'RHS',
                distractors: ['SAS', 'SSS', 'ASA'],
                explanation: 'A Right angle, the Hypotenuse and one Side. / Áõ¥Ëßí„ÄÅÊñúÈÇäÂèä‰∏ÄÈÇäÁõ∏Á≠â„ÄÇ',
                render: () => {
                    const rt1 = { p1: {x: 60, y: 200}, p2: {x: 160, y: 200}, p3: {x: 60, y: 100} };
                    const rt2 = { p1: {x: 310, y: 200}, p2: {x: 410, y: 200}, p3: {x: 310, y: 100} };
                    let s = drawTriangle(rt1) + drawTriangle(rt2);
                    s += drawAngle(rt1.p2, rt1.p1, rt1.p3, 1, true) + drawAngle(rt2.p2, rt2.p1, rt2.p3, 1, true);
                    s += drawTick(rt1.p2, rt1.p3, 1) + drawTick(rt2.p2, rt2.p3, 1);
                    s += drawTick(rt1.p1, rt1.p2, 2) + drawTick(rt2.p1, rt2.p2, 2);
                    return s;
                }
            }
        ];

        const similarData = [
            {
                id: 'AAA',
                title: 'Angle-Angle-Angle (AAA)',
                question: 'Which condition proves these triangles are SIMILAR?\nÂì™‰∏ÄÂÄãÊ¢ù‰ª∂Ë≠âÊòéÈÄô‰∫õ‰∏âËßíÂΩ¢Áõ∏‰ººÔºü',
                answer: 'AAA',
                distractors: ['3 Sides Prop.\n‰∏âÈÇäÊàêÊØî‰æã', '2 Sides Ratio + Angle\nÂÖ©ÈÇäÊàêÊØî‰æã+Â§æËßí', 'Not Similar\n‰∏çÁõ∏‰ºº'],
                explanation: 'All corresponding angles are equal. / ÊâÄÊúâÂ∞çÊáâËßíÁõ∏Á≠â„ÄÇ',
                render: () => {
                    // T1: Scale 0.8 (Width 112)
                    // T2: Scale 1.2 (Width 168) (Ratio 1.5 of T1)
                    const t1 = getCustomTri(0.8, 40); 
                    const t2 = getCustomTri(1.12, 220); // Scale relative to base
                    let s = drawTriangle(t1) + drawTriangle(t2);
                    s += drawAngle(t1.p2, t1.p1, t1.p3, 1) + drawAngle(t2.p2, t2.p1, t2.p3, 1);
                    s += drawAngle(t1.p1, t1.p2, t1.p3, 2) + drawAngle(t2.p1, t2.p2, t2.p3, 2);
                    s += drawAngle(t1.p1, t1.p3, t1.p2, 3) + drawAngle(t2.p1, t2.p3, t2.p2, 3);
                    return s;
                }
            },
            {
                id: '3SP',
                title: '3 Sides Proportional',
                question: 'Which condition proves these triangles are SIMILAR?\nÂì™‰∏ÄÂÄãÊ¢ù‰ª∂Ë≠âÊòéÈÄô‰∫õ‰∏âËßíÂΩ¢Áõ∏‰ººÔºü',
                answer: '3 Sides Prop.\n‰∏âÈÇäÊàêÊØî‰æã',
                distractors: ['AAA', '2 Sides Ratio + Angle\nÂÖ©ÈÇäÊàêÊØî‰æã+Â§æËßí', 'RHS'],
                explanation: 'All corresponding sides are in the same ratio. / ÊâÄÊúâÂ∞çÊáâÈÇäÊàêÊØî‰æã„ÄÇ',
                render: () => {
                    // T1: Scale 0.8
                    // T2: Scale 1.2 (Ratio 1.5 of T1)
                    const t1 = getCustomTri(0.8, 40);
                    const t2 = getCustomTri(1.2, 220);
                    let s = drawTriangle(t1) + drawTriangle(t2);
                    // Triangle 1 Labels
                    s += drawLabel(t1.p1, t1.p2, "4");
                    s += drawLabel(t1.p2, t1.p3, "6");
                    s += drawLabel(t1.p3, t1.p1, "8");
                    // Triangle 2 Labels
                    s += drawLabel(t2.p1, t2.p2, "6");
                    s += drawLabel(t2.p2, t2.p3, "9");
                    s += drawLabel(t2.p3, t2.p1, "12");
                    return s;
                }
            },
            {
                id: '2S1A',
                title: 'Ratio of 2 Sides + Included Angle',
                question: 'Which condition proves these triangles are SIMILAR?\nÂì™‰∏ÄÂÄãÊ¢ù‰ª∂Ë≠âÊòéÈÄô‰∫õ‰∏âËßíÂΩ¢Áõ∏‰ººÔºü',
                answer: '2 Sides Ratio + Angle\nÂÖ©ÈÇäÊàêÊØî‰æã+Â§æËßí',
                distractors: ['AAA', '3 Sides Prop.\n‰∏âÈÇäÊàêÊØî‰æã', 'SAS'],
                explanation: 'Two sides in proportion and the included angle is equal. / ÂÖ©ÈÇäÊàêÊØî‰æãÂèäÂ§æËßíÁõ∏Á≠â„ÄÇ',
                render: () => {
                    // T1: Scale 0.8
                    // T2: Scale 1.2
                    const t1 = getCustomTri(0.8, 40);
                    const t2 = getCustomTri(1.2, 220);
                    let s = drawTriangle(t1) + drawTriangle(t2);
                    // Angle
                    s += drawAngle(t1.p2, t1.p1, t1.p3, 1) + drawAngle(t2.p2, t2.p1, t2.p3, 1);
                    // Triangle 1 Sides
                    s += drawLabel(t1.p1, t1.p2, "6");
                    s += drawLabel(t1.p1, t1.p3, "8", 25);
                    // Triangle 2 Sides
                    s += drawLabel(t2.p1, t2.p2, "9");
                    s += drawLabel(t2.p1, t2.p3, "12", 25);
                    return s;
                }
            }
        ];

        /* -------------------------------------------------------------------------- */
        /* APP LOGIC                                  */
        /* -------------------------------------------------------------------------- */

        // State
        let quizQuestions = [];
        let currentQIndex = 0;
        let userAnswers = [];
        let isAnswering = false;

        // --- Quiz Logic ---
        function startQuiz() {
            // Combine and shuffle
            quizQuestions = [...congruentData.map(d => ({...d, type: 'Congruence (ÂÖ®Á≠â)'})), ...similarData.map(d => ({...d, type: 'Similarity (Áõ∏‰ºº)'}))];
            quizQuestions.sort(() => Math.random() - 0.5);
            
            // Initialize state
            userAnswers = new Array(quizQuestions.length).fill(null);
            currentQIndex = 0;
            updateScoreDisplay();
            
            document.getElementById('results-screen').classList.add('hidden');
            document.getElementById('results-screen').classList.remove('flex');
            loadQuestion();
        }

        function updateScoreDisplay() {
             // Calculate score based on stored user answers
            const currentScore = userAnswers.reduce((acc, ans, idx) => {
                if (!ans) return acc;
                return ans === quizQuestions[idx].answer ? acc + 1 : acc;
            }, 0);
            document.getElementById('current-score').textContent = currentScore;
            return currentScore;
        }

        function loadQuestion() {
            if (currentQIndex >= quizQuestions.length) {
                showResults();
                return;
            }

            const q = quizQuestions[currentQIndex];
            const storedAnswer = userAnswers[currentQIndex];
            const hasAnswered = storedAnswer !== null;

            // Update UI State
            isAnswering = !hasAnswered; // Allow answering only if not answered yet

            // Progress Bar
            document.getElementById('progress-bar').style.width = `${((currentQIndex + (hasAnswered ? 1 : 0)) / quizQuestions.length) * 100}%`;
            document.getElementById('question-type-badge').textContent = q.type;
            
            // Allow HTML in question text for line breaks
            const qText = document.getElementById('question-text');
            qText.innerHTML = q.question.replace(/\n/g, '<br>');
            
            // Render SVG
            document.getElementById('quiz-svg-container').innerHTML = createSVG(q.render());
            
            // --- Feedback Area ---
            const fb = document.getElementById('feedback');
            if (hasAnswered) {
                const isCorrect = storedAnswer === q.answer;
                fb.classList.remove('hidden');
                if (isCorrect) {
                    fb.textContent = "Correct! " + q.explanation;
                    fb.className = 'mb-4 text-center font-bold text-lg p-3 rounded-lg fade-in bg-green-100 text-green-800 border border-green-200';
                } else {
                    fb.textContent = `Incorrect. / ÈåØË™§ \n The answer is: ${q.answer}`;
                    fb.className = 'mb-4 text-center font-bold text-lg p-3 rounded-lg fade-in bg-red-100 text-red-800 border border-red-200';
                }
            } else {
                fb.classList.add('hidden');
                fb.textContent = '';
            }

            // --- Generate Options ---
            const optsContainer = document.getElementById('options-grid');
            optsContainer.innerHTML = '';
            
            if (!q.shuffledOptions) {
                 q.shuffledOptions = [q.answer, ...q.distractors].sort(() => Math.random() - 0.5);
            }

            q.shuffledOptions.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn btn-font border-2 font-bold py-3 px-4 rounded-xl text-lg shadow-sm w-full transition-all';
                btn.textContent = opt;
                
                if (hasAnswered) {
                    btn.disabled = true;
                    btn.classList.add('cursor-default');
                    if (opt === q.answer) {
                        btn.classList.add('bg-green-500', 'border-green-600', 'text-white');
                    } else if (opt === storedAnswer) {
                        btn.classList.add('bg-red-500', 'border-red-600', 'text-white');
                    } else {
                        btn.classList.add('bg-white', 'border-slate-200', 'text-slate-400');
                    }
                } else {
                    btn.disabled = false;
                    btn.classList.add('bg-white', 'border-slate-200', 'text-slate-600', 'hover:bg-sky-50', 'hover:border-sky-300');
                    btn.onclick = () => handleAnswer(opt);
                }
                
                optsContainer.appendChild(btn);
            });

            // --- Navigation Buttons State ---
            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');

            btnPrev.disabled = currentQIndex === 0;
            
            if (currentQIndex === quizQuestions.length - 1) {
                btnNext.innerHTML = 'Finish / ÂÆåÊàê &rarr;';
            } else {
                btnNext.innerHTML = 'Next / ‰∏ã‰∏ÄÈ°å &rarr;';
            }
        }

        function handleAnswer(selected) {
            if (!isAnswering) return;
            
            // Store Answer
            userAnswers[currentQIndex] = selected;
            updateScoreDisplay();
            
            // Refresh view to show feedback and lock buttons
            loadQuestion();
        }

        function prevQuestion() {
            if (currentQIndex > 0) {
                currentQIndex--;
                loadQuestion();
            }
        }

        function nextQuestion() {
            if (currentQIndex < quizQuestions.length - 1) {
                currentQIndex++;
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            const resultsScreen = document.getElementById('results-screen');
            resultsScreen.classList.remove('hidden');
            resultsScreen.classList.add('flex');
            
            // Score Display
            const finalScore = updateScoreDisplay();
            document.getElementById('final-score').textContent = finalScore;
            document.getElementById('total-questions').textContent = quizQuestions.length;
            document.getElementById('progress-bar').style.width = '100%';

            // Generate Summary Cards
            const summaryContainer = document.getElementById('summary-list');
            summaryContainer.innerHTML = ''; // Clear previous

            quizQuestions.forEach((q, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === q.answer;
                const isUnanswered = userAnswer === null;

                const card = document.createElement('div');
                card.className = `p-4 rounded-2xl border-2 ${isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'} flex flex-col md:flex-row gap-4 items-center`;

                // Mini SVG container
                const svgContainer = document.createElement('div');
                svgContainer.className = 'w-full md:w-48 h-32 bg-white rounded-xl border border-slate-100 flex-shrink-0 flex items-center justify-center';
                svgContainer.innerHTML = createSVG(q.render());

                // Text Content
                const content = document.createElement('div');
                content.className = 'flex-grow text-center md:text-left w-full';
                
                const title = document.createElement('h4');
                title.className = 'font-bold text-slate-700 mb-1';
                title.textContent = `Q${index + 1}: ${q.type}`;

                const qText = document.createElement('p');
                qText.className = 'text-sm text-slate-500 mb-2';
                qText.textContent = q.question.split('\n')[0]; // Just take English part for summary brevity

                const resultText = document.createElement('div');
                if (isCorrect) {
                    resultText.innerHTML = `<span class="text-green-600 font-bold">‚úì Correct</span><br><span class="text-sm text-slate-600">Answer: ${userAnswer}</span>`;
                } else {
                    const wrongAns = isUnanswered ? 'None' : userAnswer;
                    resultText.innerHTML = `<span class="text-red-600 font-bold">‚úó Incorrect</span><br><span class="text-sm text-slate-600">Your Answer: <span class="line-through decoration-red-500">${wrongAns}</span></span><br><span class="text-sm text-green-700 font-bold">Correct: ${q.answer}</span>`;
                }

                content.appendChild(title);
                content.appendChild(qText);
                content.appendChild(resultText);

                card.appendChild(svgContainer);
                card.appendChild(content);
                summaryContainer.appendChild(card);
            });
        }

        // --- Init ---
        startQuiz();

    </script>
</body>
</html>